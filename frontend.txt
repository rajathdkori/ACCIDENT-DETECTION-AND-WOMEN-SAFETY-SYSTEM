<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Safety Pole — Live Dashboard</title>
  <!-- Leaflet for map (CDN) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="" crossorigin="" />
  <style>
    :root{
      --bg: #f7fafc; /* very light */
      --card: #ffffff;
      --muted: #6b7280;
      --accent: #7dd3fc; /* sky */
      --accent-2: #a7f3d0; /* mint */
      --warning: #fef08a; /* mild yellow */
      --danger: #fb7185; /* soft red */
      --success: #34d399; /* gentle green */
      --glass: rgba(255,255,255,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing: border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#f1f5f9);color:#0f172a}
    .app{
      display:grid;
      grid-template-columns: 360px 1fr 360px;
      gap:20px;
      padding:28px;
      height:100vh;
      align-items:start;
    }

    /* Left column */
    .panel{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#003049;font-weight:700;font-size:20px}
    .title{font-size:18px;font-weight:700}
    .subtitle{font-size:12px;color:var(--muted)}

    .stats{display:flex;flex-direction:column;gap:12px;margin-top:16px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.6),var(--glass));backdrop-filter: blur(4px)}
    .stat .name{font-size:13px;color:var(--muted)}
    .stat .value{font-weight:700}

    .buttons{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .btn{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn-quiet{background:#eef2ff;color:#3730a3}
    .btn-danger{background:linear-gradient(90deg,#fecaca,#fb7185);color:#7f1d1d}
    .btn-soft{background:#fffef2;border:1px solid rgba(15,23,42,0.06)}

    /* center map */
    .map-card{height:76vh;overflow:hidden;position:relative}
    #map{height:100%;width:100%;border-radius:12px}
    .marker-legend{position:absolute;left:14px;top:14px;background:rgba(255,255,255,0.9);padding:10px;border-radius:10px;font-size:13px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}

    /* right column */
    .alerts{display:flex;flex-direction:column;gap:12px}
    .alert-item{display:flex;gap:12px;align-items:center;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.7),#ffffff)}
    .alert-dot{width:12px;height:12px;border-radius:50%}
    .alert-content{flex:1}
    .alert-time{font-size:12px;color:var(--muted)}

    .header-row{display:flex;justify-content:space-between;align-items:center}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center;z-index:50}
    .modal{background:var(--card);padding:20px;border-radius:12px;max-width:520px;width:92%;box-shadow:0 10px 40px rgba(2,6,23,0.25)}
    .danger-flag{display:flex;gap:12px;align-items:center}
    .big-red{width:52px;height:52px;border-radius:10px;background:linear-gradient(180deg,#ffb4c6,#fb7185);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}

    footer{position:fixed;left:28px;bottom:18px;font-size:12px;color:var(--muted)}

    /* responsive */
    @media (max-width: 1100px){
      .app{grid-template-columns:1fr;grid-auto-rows:auto;padding:16px}
      .map-card{height:64vh}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="panel">
      <div class="brand">
        <div class="logo">SSP</div>
        <div>
          <div class="title">Smart Safety Pole</div>
          <div class="subtitle">Real-time alerts • Mild palette • Emergency contact</div>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div><div class="name">Connected Poles</div><div class="subtitle">Online and reporting</div></div><div class="value" id="connected">12</div></div>
        <div class="stat"><div><div class="name">Active Alerts (24h)</div></div><div class="value" id="activeAlerts">3</div></div>
        <div class="stat"><div><div class="name">Last Event</div></div><div class="value" id="lastEvent">No events yet</div></div>
      </div>

      <div style="margin-top:14px;">
        <div class="header-row"><strong>Controls</strong><small class="subtitle">(simulate)</small></div>
        <div class="buttons">
          <button class="btn btn-quiet" onclick="simulate('accident')">Simulate Accident</button>
          <button class="btn btn-quiet" onclick="simulate('scream')">Simulate Scream</button>
          <button class="btn btn-quiet" onclick="simulate('fire')">Simulate Fire</button>
          <button class="btn btn-danger" onclick="simulate('redflag')">Raise Red Flag (Emergency)</button>
          <button class="btn btn-soft" onclick="clearAlerts()">Clear Alerts</button>
        </div>
      </div>

      <div style="margin-top:14px;">
        <div class="header-row"><strong>Emergency Contact</strong></div>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <input id="emContact" value="112" style="flex:1;padding:10px;border-radius:10px;border:1px solid rgba(15,23,42,0.06)" />
          <button class="btn btn-quiet" onclick="callEmergency()">Call</button>
        </div>
        <div style="margin-top:8px;font-size:12px;color:var(--muted)">When a <strong style="color:var(--danger)">Red Flag</strong> is raised the dashboard will contact this number automatically.</div>
      </div>
    </div>

    <div class="map-card panel">
      <div id="map"></div>
      <div class="marker-legend">
        <div style="font-weight:700">Live Map</div>
        <div style="margin-top:6px;font-size:13px;color:var(--muted)">Poles &nbsp; • &nbsp; Alerts</div>
        <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
          <div style="width:12px;height:12px;border-radius:50%;background:var(--success)"></div><small class="subtitle">Healthy</small>
          <div style="width:12px;height:12px;border-radius:50%;background:var(--warning)"></div><small class="subtitle">Watch</small>
          <div style="width:12px;height:12px;border-radius:50%;background:var(--danger)"></div><small class="subtitle">Alert</small>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="header-row"><strong>Recent Alerts</strong><div class="subtitle">auto-updates</div></div>
      <div class="alerts" id="alertsList" style="margin-top:12px">
        <!-- dynamically populated -->
      </div>

      <div style="margin-top:14px">
        <strong>Event Log</strong>
        <div id="eventLog" style="margin-top:8px;max-height:36vh;overflow:auto;padding-right:6px;color:var(--muted);font-size:13px"></div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="danger-flag">
        <div class="big-red">!</div>
        <div>
          <div style="font-weight:800;font-size:16px">Red Flag — Emergency</div>
          <div style="color:var(--muted);margin-top:6px">This requires immediate attention. The system will contact emergency services.</div>
        </div>
      </div>
      <div style="margin-top:14px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn btn-soft" onclick="dismissModal()">Dismiss</button>
        <button class="btn btn-danger" onclick="confirmContact()">Contact Emergency Now</button>
      </div>
    </div>
  </div>

  <footer>Design: gentle, readable, and action-first UI — Smart Safety Pole</footer>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Simple simulated dashboard JS
    const alerts = [];
    const poles = generatePoles(12);

    const map = L.map('map', {zoomControl:true}).setView([20.5937,78.9629], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    const poleMarkers = [];
    poles.forEach(p => {
      const m = L.circleMarker([p.lat,p.lng],{radius:10,fillOpacity:0.95,color:p.color}).addTo(map)
        .bindPopup(`<strong>Pole ${p.id}</strong><div style='font-size:13px;color:#6b7280'>Status: ${p.status}</div>`);
      poleMarkers.push({id:p.id,marker:m});
    });

    function generatePoles(n){
      const list=[];
      for(let i=0;i<n;i++){
        // random locations across india-ish box for demo
        const lat = 8 + Math.random()*20; const lng = 68 + Math.random()*20;
        const status = Math.random()>0.2? 'healthy' : (Math.random()>0.5? 'watch':'alert');
        const color = status==='healthy'? 'var(--success)': status==='watch'? 'var(--warning)': 'var(--danger)';
        list.push({id:i+1,lat,lng,status,color});
      }
      return list;
    }

    // UI helpers
    function addAlert(type, details, lat= null, lng = null){
      const time = new Date();
      const id = Date.now();
      const level = severityFor(type);
      const item = {id,type,details,time:time.toLocaleString(),lat,lng,level};
      alerts.unshift(item);
      renderAlerts();
      pushEventLog(`${time.toLocaleString()} — ${type.toUpperCase()}: ${details}`);
      document.getElementById('activeAlerts').textContent = alerts.length;
      document.getElementById('lastEvent').textContent = `${type} @ ${time.toLocaleTimeString()}`;
      // show red-flag modal if critical
      if(type==='redflag') showModal();
      // update map with a temporary marker
      if(lat && lng){
        const tmp = L.circle([lat,lng],{radius:60,fillOpacity:0.12,color: level==='critical'? '#fb7185': level==='high'? '#fef08a':'#34d399'}).addTo(map);
        setTimeout(()=>map.removeLayer(tmp),12000);
      }
    }

    function renderAlerts(){
      const container = document.getElementById('alertsList');
      container.innerHTML='';
      alerts.slice(0,10).forEach(a=>{
        const el = document.createElement('div'); el.className='alert-item';
        const dot = document.createElement('div'); dot.className='alert-dot';
        dot.style.background = a.level==='critical'? 'var(--danger)': a.level==='high'? 'var(--warning)': 'var(--success)';
        const content = document.createElement('div'); content.className='alert-content';
        content.innerHTML = `<div style="font-weight:700">${a.type.toUpperCase()}</div><div class='alert-time'>${a.time} · ${a.details}</div>`;
        el.appendChild(dot); el.appendChild(content);
        container.appendChild(el);
      })
    }

    function pushEventLog(text){
      const area = document.getElementById('eventLog');
      const p = document.createElement('div'); p.textContent = text; area.prepend(p);
    }

    function severityFor(t){
      if(t==='redflag' || t==='fire') return 'critical';
      if(t==='accident' || t==='scream') return 'high';
      return 'low';
    }

    // Simulate sensors
    function simulate(type){
      const coords = randomNearCenter();
      let details='';
      switch(type){
        case 'accident': details='Vehicle collision detected (impact sensor + accel).'; break;
        case 'scream': details='Loud human distress audio detected (ML model).'; break;
        case 'fire': details='Rapid temperature rise & smoke detected.'; break;
        case 'redflag': details='Operator raised immediate red flag — dispatch required.'; break;
      }
      addAlert(type,details,coords.lat,coords.lng);
      // if redflag -> auto-contact
      if(type==='redflag') automaticContact();
    }

    function randomNearCenter(){
      const c = map.getCenter();
      return {lat: c.lat + (Math.random()-0.5)*0.5, lng: c.lng + (Math.random()-0.5)*0.5};
    }

    function clearAlerts(){
      alerts.length = 0; renderAlerts(); document.getElementById('activeAlerts').textContent = 0; pushEventLog(`${new Date().toLocaleString()} — Alerts cleared`);
    }

    // Modal flow
    function showModal(){document.getElementById('modal').style.display='flex'}
    function dismissModal(){document.getElementById('modal').style.display='none'}

    // Contacting emergency (demo: opens tel: link and logs a POST to console)
    function callEmergency(){
      const number = document.getElementById('emContact').value || '112';
      window.open(`tel:${number}`);
      pushEventLog(`${new Date().toLocaleString()} — Manual call initiated to ${number}`);
    }

    function confirmContact(){
      const number = document.getElementById('emContact').value || '112';
      // simulate API call to emergency services
      fakePost('/api/contact', {number,reason:'redflag',ts:new Date().toISOString()})
        .then(()=>{
          window.open(`tel:${number}`);
          pushEventLog(`${new Date().toLocaleString()} — Emergency contacted: ${number}`);
          dismissModal();
        })
        .catch(()=>{
          pushEventLog(`${new Date().toLocaleString()} — Failed to contact emergency (simulated)`);
        })
    }

    function automaticContact(){
      // automatic contact when redflag raised — simulated but logs and pings
      pushEventLog(`${new Date().toLocaleString()} — Auto-contact triggered (red flag). Attempting to contact emergency services...`);
      // highlight UI: flash header
      flashBackground();
      // In a real deployment: server would POST with authenticated data to an emergency endpoint and trigger dispatch
    }

    function fakePost(url, body){
      // Demo fake network call (returns resolved promise)
      console.log('POST',url,body);
      return new Promise(resolve=>setTimeout(resolve,900));
    }

    function flashBackground(){
      const el = document.querySelector('.brand');
      el.animate([{background:'#fff'},{background:'rgba(251,113,133,0.08)'},{background:'#fff'}],{duration:800,iterations:3});
    }

    // initial render
    renderAlerts();
    document.getElementById('connected').textContent = poles.length;

    // expose little API for developers
    window.SSP = {simulate,addAlert,clearAlerts,pushEventLog};

    // small accessibility: keyboard 'r' to raise a test redflag
    window.addEventListener('keydown', e=>{ if(e.key==='r') simulate('redflag') });
  </script>
</body>
</html>